<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>多值同时运动--链式运动</title>
    <style>
    #div1 {
        width: 100px;
        height: 100px;
        background-color: red;
        position: absolute;
        left: 100px;
        top: 100px;
    }
    </style>
    <script>
    window.onload = function() {
        var oDiv = document.getElementById('div1');
        oDiv.onclick = function() {

            startMove(this, {
                width: 200,
                height: 200
            }, 10,function(){
                startMove(this,{opacity: 0},-10);
            });
        }

        function startMove(obj, json, iSpeed,fn) {
            clearInterval(obj.iTimer);
            var iCur = 0;
            obj.iTimer = setInterval(function() {
                var iBtn = true;
                //什么时候停止，所有属性都运动到了目标点后
                for (var attr in json) {
                    var iTarget = json[attr];
                    if (attr == 'opacity') {
                        iCur = Math.round(css(obj, 'opacity') * 100);
                        console.log(iCur);
                    } else {
                        iCur = parseInt(css(obj, attr));
                    }


                    if (iCur != iTarget) {
                        iBtn = false
                        if (attr == 'opacity') {
                            obj.style.opacity = (iCur + iSpeed) / 100;
                            obj.style.filter = 'alpha(opacity=' + (iCur + iSpeed) + ')';
                        } else {
                            obj.style[attr] = iCur + iSpeed + 'px';
                        }
                    }
                }
                //判读是否所有属性都到了目标点
                if(iBtn) {
                    clearInterval(obj.iTimer);
                    fn&&fn.call(obj);   //将this指向obj
                }
            }, 30)
        }



        function css(obj, attr) {
            if (obj.currentStyle) {
                return obj.currentStyle[attr];
            } else {
                return getComputedStyle(obj, false)[attr];
            }
        }
    }
    </script>
</head>

<body>
    <div id="div1"></div>
</body>

</html>